#!/usr/bin/python
import os
import select
import time

irrc_map = {
	'\x06\x02\x00\x00\x00\x00\x00\x00\x06\x00\x00\x00\x00\x00\x00\x00'	:	'moon',
	'\x04\x01\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'	:	'home',
	'\x05\x00 \x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'		:	'|<',
	'\x05\x00\x01\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'>/||',
	'\x05\x00\x10\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'>|',
	'\x05\x00\x08\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'<<',
	'\x05\x00@\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'		:	'stop',
	'\x05\x00\x04\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'>>',
	'\x01\x00\x00\x00\x00R\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'up',
	'\x01\x00\x00\x00\x00P\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'left',
	'\x01\x00\x00\x00\x00(\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'ok',
	'\x01\x00\x00\x00\x00O\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'right',
	'\x01\x00\x00\x00\x00Q\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'down',
	'\x05\x01\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'vol+',
	'\x05\x08\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'ch+',
	'\x05\x02\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'vol-',
	'\x01\x00\x00\x00\x00*\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'back',
	'\x05\x10\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'ch-',
	'\x01\x00\x00\x00\x00\x1e\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'	:	'1',
	'\x01\x00\x00\x00\x00\x1f\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'	:	'2',
	'\x01\x00\x00\x00\x00 \x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'3',
	'\x01\x00\x00\x00\x00!\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'4',
	'\x01\x00\x00\x00\x00"\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'5',
	'\x01\x00\x00\x00\x00#\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'6',
	'\x01\x00\x00\x00\x00$\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'7',
	'\x01\x00\x00\x00\x00%\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'8',
	'\x01\x00\x00\x00\x00&\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'		:	'9',
	'\x02\x10\x00\x00\x00\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00'	:	'fullscreen',
	'\x01\x00\x00\x00\x00\'\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00'	:	'0',
	'\x04\x00\x04\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'	:	'menu',
	'\x05\x00\x02\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'rec',
	'\x04\x00 \x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'		:	'txt',
	'\x05\x04\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00'	:	'mute',
	'\x04\x02\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'	:	'tv',
	'\x03\x04\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00'	:	'radio',
	'\x04\x08\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'	:	'red',
	'\x04\x10\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'	:	'green',
	'\x04 \x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'		:	'blue',
	'\x04\x80\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00'	:	'yellow'	}

irrc_present = False

try:
	irrc = open('/dev/hidraw0', 'r')
except:
	pass

def irrc_open():
	global irrc_present
	global irrc

	if os.path.exists('/dev/hidraw0'):
		try:
			os.system('sudo chmod +r /dev/hidraw0')
			irrc = open('/dev/hidraw0', 'r')
			irrc_present = True
		except:
			irrc_present = False

def irrc_key():
	global irrc_present
	global irrc

	k = ''
	if not irrc_present:
		irrc_open()
	if irrc_present:
		try:
			rrdy, wrdy, xrdy = select.select([irrc], [], [], 0)
			if rrdy:
				q = irrc.read(16)
				k = irrc_map[q]
		except IOError:
			irrc_present = False
			try:
				irrc.close()
			except:
				pass
	return k

while True:
	time.sleep(0.05)
	k = irrc_key()
	if k != '':
		print k
